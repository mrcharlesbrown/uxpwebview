<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AI Webview</title>
</head>
<body>
  <script>
    window.addEventListener("message", async (event) => {
      const { type, prompt, apiKey } = event.data;

      if (type === "ask-ai" && prompt && apiKey) {
        try {
          const res = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${apiKey}`
            },
            body: JSON.stringify({
              model: "gpt-3.5-turbo",
              messages: [{ role: "user", content: prompt }],
              temperature: 0.7
            })
          });

          const json = await res.json();

          if (json.choices && json.choices.length > 0) {
            parent.postMessage({ type: "ai-response", response: json.choices[0].message.content }, "*");
          } else {
            parent.postMessage({ type: "ai-error", error: JSON.stringify(json) }, "*");
          }

        } catch (err) {
          parent.postMessage({ type: "ai-error", error: err.message }, "*");
        }
      }
    });
  </script>
</body>
</html>
