<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>AI Webview</title>
</head>
<body>
  <script>
    window.addEventListener("message", async (event) => {
      const msg = event.data;
      if (msg.type === "askAI") {
        try {
          const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              "Authorization": `Bearer ${msg.apiKey}`
            },
            body: JSON.stringify({
              model: "gpt-4",
              messages: [{ role: "user", content: msg.prompt }]
            })
          });

          const result = await response.json();
          const content = result.choices?.[0]?.message?.content || "No response";

          parent.postMessage({ type: "response", result: content }, "*");
        } catch (e) {
          parent.postMessage({ type: "error", error: e.message }, "*");
        }
      }
    });
  </script>
</body>
</html>
